services:
  trace-gen:
    build:
      context: ./trace-generator
      dockerfile_inline: |
        FROM python:3.7
        RUN --mount=type=bind,target=/tg \
            cp /tg/Pipfile.lock /Pipfile.lock &&\
            pip install pipenv && \
            pipenv requirements > requirements.txt && \
            pip install -r requirements.txt && \
            pip install spar && \
            mv /usr/local/lib/python3.7/site-packages/spar/data/samples /original-spar-1h-trace && \
            echo "Y" | pip uninstall spar && \
            echo "Y" | pip uninstall pipenv && \
            rm Pipfile.lock requirements.txt

    entrypoint: /bin/bash
    working_dir: /app
    tty: true
    volumes:
      - ./trace-generator:/app
      - ./generated:/generated
      - ./traces/alibaba/2018:/trace # Make downloaded alibaba trace avaliable (optional)
